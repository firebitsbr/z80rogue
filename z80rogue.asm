	;
	; z80rogue para MSX
	;
	; por Óscar Toledo Gutiérrez
	;
	; (c) Copyright 2019 Óscar Toledo Gutiérrez
	;
	; Creación: 29-sep-2019.
	;

	fname "z80rogue.rom"

	org $4000,$7fff

VDP.DR:	equ $0006
VDP.DW:	equ $0007

WRTVDP:	equ $0047
RDVRM:	equ $004a
WRTVRM:	equ $004d
FILVRM:	equ $0056
LDIRVM:	equ $005c
GTSTCK:	equ $00d5
GTTRIG:	equ $00d8

	db $41,$42
	dw inicio
	dw 0
	dw 0
	dw 0

int_handler:
	ld a,(VDP.DR)
	ld c,a
	inc c
	in a,(c)
	ret

inicio:
	ld sp,stack
	; Sound guaranteed to be off
	ld hl,int_handler
	ld ($fd9b),hl
	ld a,$c3
	ld ($fd9a),a

	call vdp_mode_0

	jr $

        ;
        ; Mode 0 table (text 40x24)
        ;
mode_0_table:
        DB $00          ; Register 0 - Mode 0
        DB $B0          ; Register 1 - Mode 0, turn off video
        DB $0E          ; Register 2 - Screen patterns $3800
        DB $FF          ; Register 3 - Color table $2000 (not used)
        DB $00          ; Register 4 - Bitmap table $0000
        DB $7F          ; Register 5 - Sprites attributes $3F80 (not used)
        DB $03          ; Register 6 - Sprites bitmaps $1800 (not used)
        DB $21          ; Register 7 - Green letters, black background

	;
	; Pone el modo de video 0 (40x24 columnas)
	;
vdp_mode_0:
	ld hl,mode_0_table
	ld bc,$0800
.1:	push bc
	ld b,(hl)
	call WRTVDP
	pop bc
	inc c
	inc hl
	djnz .1

	ld hl,letters_bitmaps
	ld de,$0000
	ld bc,$0800
	call LDIRVM

	ld hl,$3800
	ld bc,$0400
	ld a,$20
	call FILVRM

	ld hl,test
	ld de,$3800
	ld bc,16
	call LDIRVM

	ld bc,$f001	; Enable screen
	jp WRTVDP

test:
	db "OSCAR WAS HERE ",$01

letters_bitmaps:
	db $00,$00,$00,$00,$00,$00,$00,$00	; $00
	db $78,$fc,$b4,$fc,$fc,$b4,$84,$78	; $01 - Happy face
	db $00,$00,$00,$00,$00,$00,$00,$00	; $02
	db $00,$00,$00,$00,$00,$00,$00,$00	; $03
	db $00,$00,$00,$00,$00,$00,$00,$00	; $04
	db $00,$00,$00,$00,$00,$00,$00,$00	; $05
	db $00,$00,$00,$00,$00,$00,$00,$00	; $06
	db $00,$00,$00,$00,$00,$00,$00,$00	; $07

	db $00,$00,$00,$00,$00,$00,$00,$00	; $08
	db $00,$00,$00,$00,$00,$00,$00,$00	; $09
	db $00,$00,$00,$00,$00,$00,$00,$00	; $0a
	db $00,$00,$00,$00,$00,$00,$00,$00	; $0b
	db $00,$00,$00,$00,$00,$00,$00,$00	; $0c
	db $00,$00,$00,$00,$00,$00,$00,$00	; $0d
	db $00,$00,$00,$00,$00,$00,$00,$00	; $0e
	db $00,$00,$00,$00,$00,$00,$00,$00	; $0f

	db $00,$00,$00,$00,$00,$00,$00,$00	; $10
	db $00,$00,$00,$00,$00,$00,$00,$00	; $11
	db $00,$00,$00,$00,$00,$00,$00,$00	; $12
	db $00,$00,$00,$00,$00,$00,$00,$00	; $13
	db $00,$00,$00,$00,$00,$00,$00,$00	; $14
	db $00,$00,$00,$00,$00,$00,$00,$00	; $15
	db $00,$00,$00,$00,$00,$00,$00,$00	; $16
	db $00,$00,$00,$00,$00,$00,$00,$00	; $17

	db $00,$00,$00,$00,$00,$00,$00,$00	; $18
	db $00,$00,$00,$00,$00,$00,$00,$00	; $19
	db $00,$00,$00,$00,$00,$00,$00,$00	; $1a
	db $00,$00,$00,$00,$00,$00,$00,$00	; $1b
	db $00,$00,$00,$00,$00,$00,$00,$00	; $1c
	db $00,$00,$00,$00,$00,$00,$00,$00	; $1d
	db $00,$00,$00,$00,$00,$00,$00,$00	; $1e
	db $00,$00,$00,$00,$00,$00,$00,$00	; $1f

	db $00,$00,$00,$00,$00,$00,$00,$00	; $20
	db $00,$00,$00,$00,$00,$00,$00,$00	; $21
	db $00,$00,$00,$00,$00,$00,$00,$00	; $22
	db $00,$00,$00,$00,$00,$00,$00,$00	; $23
	db $00,$00,$00,$00,$00,$00,$00,$00	; $24
	db $00,$00,$00,$00,$00,$00,$00,$00	; $25
	db $00,$00,$00,$00,$00,$00,$00,$00	; $26
	db $00,$00,$00,$00,$00,$00,$00,$00	; $27

	db $00,$00,$00,$00,$00,$00,$00,$00	; $28
	db $00,$00,$00,$00,$00,$00,$00,$00	; $29
	db $00,$00,$00,$00,$00,$00,$00,$00	; $2a
	db $00,$00,$00,$00,$00,$00,$00,$00	; $2b
	db $00,$00,$00,$00,$00,$00,$00,$00	; $2c
	db $00,$00,$00,$00,$00,$00,$00,$00	; $2d
	db $00,$00,$00,$00,$00,$00,$00,$00	; $2e
	db $00,$00,$00,$00,$00,$00,$00,$00	; $2f

	db $00,$00,$00,$00,$00,$00,$00,$00	; $30
	db $00,$00,$00,$00,$00,$00,$00,$00	; $31
	db $00,$00,$00,$00,$00,$00,$00,$00	; $32
	db $00,$00,$00,$00,$00,$00,$00,$00	; $33
	db $00,$00,$00,$00,$00,$00,$00,$00	; $34
	db $00,$00,$00,$00,$00,$00,$00,$00	; $35
	db $00,$00,$00,$00,$00,$00,$00,$00	; $36
	db $00,$00,$00,$00,$00,$00,$00,$00	; $37

	db $00,$00,$00,$00,$00,$00,$00,$00	; $38
	db $00,$00,$00,$00,$00,$00,$00,$00	; $39
	db $00,$00,$00,$00,$00,$00,$00,$00	; $3a
	db $00,$00,$00,$00,$00,$00,$00,$00	; $3b
	db $00,$00,$00,$00,$00,$00,$00,$00	; $3c
	db $00,$00,$00,$00,$00,$00,$00,$00	; $3d
	db $00,$00,$00,$00,$00,$00,$00,$00	; $3e
	db $00,$00,$00,$00,$00,$00,$00,$00	; $3f

	db $00,$00,$00,$00,$00,$00,$00,$00	; $40
	db $20,$50,$88,$88,$f8,$88,$88,$00	; $41
	db $00,$00,$00,$00,$00,$00,$00,$00	; $42
	db $70,$88,$80,$80,$80,$88,$70,$00	; $43
	db $00,$00,$00,$00,$00,$00,$00,$00	; $44
	db $f8,$80,$80,$f0,$80,$80,$f8,$00	; $45
	db $00,$00,$00,$00,$00,$00,$00,$00	; $46
	db $00,$00,$00,$00,$00,$00,$00,$00	; $47

	db $88,$88,$88,$f8,$88,$88,$88,$00	; $48
	db $00,$00,$00,$00,$00,$00,$00,$00	; $49
	db $00,$00,$00,$00,$00,$00,$00,$00	; $4a
	db $00,$00,$00,$00,$00,$00,$00,$00	; $4b
	db $00,$00,$00,$00,$00,$00,$00,$00	; $4c
	db $00,$00,$00,$00,$00,$00,$00,$00	; $4d
	db $00,$00,$00,$00,$00,$00,$00,$00	; $4e
	db $70,$88,$88,$88,$88,$88,$70,$00	; $4f

	db $00,$00,$00,$00,$00,$00,$00,$00	; $50
	db $00,$00,$00,$00,$00,$00,$00,$00	; $51
	db $f0,$88,$88,$f0,$a0,$90,$88,$00	; $52
	db $78,$80,$80,$70,$08,$08,$f0,$00	; $53
	db $00,$00,$00,$00,$00,$00,$00,$00	; $54
	db $00,$00,$00,$00,$00,$00,$00,$00	; $55
	db $00,$00,$00,$00,$00,$00,$00,$00	; $56
	db $88,$88,$88,$88,$a8,$a8,$50,$00	; $57

	db $00,$00,$00,$00,$00,$00,$00,$00	; $58
	db $00,$00,$00,$00,$00,$00,$00,$00	; $59
	db $00,$00,$00,$00,$00,$00,$00,$00	; $5a
	db $00,$00,$00,$00,$00,$00,$00,$00	; $5b
	db $00,$00,$00,$00,$00,$00,$00,$00	; $5c
	db $00,$00,$00,$00,$00,$00,$00,$00	; $5d
	db $00,$00,$00,$00,$00,$00,$00,$00	; $5e
	db $00,$00,$00,$00,$00,$00,$00,$00	; $5f

	db $00,$00,$00,$00,$00,$00,$00,$00	; $60
	db $00,$00,$00,$00,$00,$00,$00,$00	; $61
	db $00,$00,$00,$00,$00,$00,$00,$00	; $62
	db $00,$00,$00,$00,$00,$00,$00,$00	; $63
	db $00,$00,$00,$00,$00,$00,$00,$00	; $64
	db $00,$00,$00,$00,$00,$00,$00,$00	; $65
	db $00,$00,$00,$00,$00,$00,$00,$00	; $66
	db $00,$00,$00,$00,$00,$00,$00,$00	; $67

	db $00,$00,$00,$00,$00,$00,$00,$00	; $68
	db $00,$00,$00,$00,$00,$00,$00,$00	; $69
	db $00,$00,$00,$00,$00,$00,$00,$00	; $6a
	db $00,$00,$00,$00,$00,$00,$00,$00	; $6b
	db $00,$00,$00,$00,$00,$00,$00,$00	; $6c
	db $00,$00,$00,$00,$00,$00,$00,$00	; $6d
	db $00,$00,$00,$00,$00,$00,$00,$00	; $6e
	db $00,$00,$00,$00,$00,$00,$00,$00	; $6f

	db $00,$00,$00,$00,$00,$00,$00,$00	; $70
	db $00,$00,$00,$00,$00,$00,$00,$00	; $71
	db $00,$00,$00,$00,$00,$00,$00,$00	; $72
	db $00,$00,$00,$00,$00,$00,$00,$00	; $73
	db $00,$00,$00,$00,$00,$00,$00,$00	; $74
	db $00,$00,$00,$00,$00,$00,$00,$00	; $75
	db $00,$00,$00,$00,$00,$00,$00,$00	; $76
	db $00,$00,$00,$00,$00,$00,$00,$00	; $77

	db $00,$00,$00,$00,$00,$00,$00,$00	; $78
	db $00,$00,$00,$00,$00,$00,$00,$00	; $79
	db $00,$00,$00,$00,$00,$00,$00,$00	; $7a
	db $00,$00,$00,$00,$00,$00,$00,$00	; $7b
	db $00,$00,$00,$00,$00,$00,$00,$00	; $7c
	db $00,$00,$00,$00,$00,$00,$00,$00	; $7d
	db $00,$00,$00,$00,$00,$00,$00,$00	; $7e
	db $00,$00,$00,$00,$00,$00,$00,$00	; $7f

	db $00,$00,$00,$00,$00,$00,$00,$00	; $80
	db $00,$00,$00,$00,$00,$00,$00,$00	; $81
	db $00,$00,$00,$00,$00,$00,$00,$00	; $82
	db $00,$00,$00,$00,$00,$00,$00,$00	; $83
	db $00,$00,$00,$00,$00,$00,$00,$00	; $84
	db $00,$00,$00,$00,$00,$00,$00,$00	; $85
	db $00,$00,$00,$00,$00,$00,$00,$00	; $86
	db $00,$00,$00,$00,$00,$00,$00,$00	; $87

	db $00,$00,$00,$00,$00,$00,$00,$00	; $88
	db $00,$00,$00,$00,$00,$00,$00,$00	; $89
	db $00,$00,$00,$00,$00,$00,$00,$00	; $8a
	db $00,$00,$00,$00,$00,$00,$00,$00	; $8b
	db $00,$00,$00,$00,$00,$00,$00,$00	; $8c
	db $00,$00,$00,$00,$00,$00,$00,$00	; $8d
	db $00,$00,$00,$00,$00,$00,$00,$00	; $8e
	db $00,$00,$00,$00,$00,$00,$00,$00	; $8f

	db $00,$00,$00,$00,$00,$00,$00,$00	; $90
	db $00,$00,$00,$00,$00,$00,$00,$00	; $91
	db $00,$00,$00,$00,$00,$00,$00,$00	; $92
	db $00,$00,$00,$00,$00,$00,$00,$00	; $93
	db $00,$00,$00,$00,$00,$00,$00,$00	; $94
	db $00,$00,$00,$00,$00,$00,$00,$00	; $95
	db $00,$00,$00,$00,$00,$00,$00,$00	; $96
	db $00,$00,$00,$00,$00,$00,$00,$00	; $97

	db $00,$00,$00,$00,$00,$00,$00,$00	; $98
	db $00,$00,$00,$00,$00,$00,$00,$00	; $99
	db $00,$00,$00,$00,$00,$00,$00,$00	; $9a
	db $00,$00,$00,$00,$00,$00,$00,$00	; $9b
	db $00,$00,$00,$00,$00,$00,$00,$00	; $9c
	db $00,$00,$00,$00,$00,$00,$00,$00	; $9d
	db $00,$00,$00,$00,$00,$00,$00,$00	; $9e
	db $00,$00,$00,$00,$00,$00,$00,$00	; $9f

	db $00,$00,$00,$00,$00,$00,$00,$00	; $a0
	db $00,$00,$00,$00,$00,$00,$00,$00	; $a1
	db $00,$00,$00,$00,$00,$00,$00,$00	; $a2
	db $00,$00,$00,$00,$00,$00,$00,$00	; $a3
	db $00,$00,$00,$00,$00,$00,$00,$00	; $a4
	db $00,$00,$00,$00,$00,$00,$00,$00	; $a5
	db $00,$00,$00,$00,$00,$00,$00,$00	; $a6
	db $00,$00,$00,$00,$00,$00,$00,$00	; $a7

	db $00,$00,$00,$00,$00,$00,$00,$00	; $a8
	db $00,$00,$00,$00,$00,$00,$00,$00	; $a9
	db $00,$00,$00,$00,$00,$00,$00,$00	; $aa
	db $00,$00,$00,$00,$00,$00,$00,$00	; $ab
	db $00,$00,$00,$00,$00,$00,$00,$00	; $ac
	db $00,$00,$00,$00,$00,$00,$00,$00	; $ad
	db $00,$00,$00,$00,$00,$00,$00,$00	; $ae
	db $00,$00,$00,$00,$00,$00,$00,$00	; $af

	db $00,$00,$00,$00,$00,$00,$00,$00	; $b0
	db $00,$00,$00,$00,$00,$00,$00,$00	; $b1
	db $00,$00,$00,$00,$00,$00,$00,$00	; $b2
	db $00,$00,$00,$00,$00,$00,$00,$00	; $b3
	db $00,$00,$00,$00,$00,$00,$00,$00	; $b4
	db $00,$00,$00,$00,$00,$00,$00,$00	; $b5
	db $00,$00,$00,$00,$00,$00,$00,$00	; $b6
	db $00,$00,$00,$00,$00,$00,$00,$00	; $b7

	db $00,$00,$00,$00,$00,$00,$00,$00	; $b8
	db $00,$00,$00,$00,$00,$00,$00,$00	; $b9
	db $00,$00,$00,$00,$00,$00,$00,$00	; $ba
	db $00,$00,$00,$00,$00,$00,$00,$00	; $bb
	db $00,$00,$00,$00,$00,$00,$00,$00	; $bc
	db $00,$00,$00,$00,$00,$00,$00,$00	; $bd
	db $00,$00,$00,$00,$00,$00,$00,$00	; $be
	db $00,$00,$00,$00,$00,$00,$00,$00	; $bf

	db $00,$00,$00,$00,$00,$00,$00,$00	; $c0
	db $00,$00,$00,$00,$00,$00,$00,$00	; $c1
	db $00,$00,$00,$00,$00,$00,$00,$00	; $c2
	db $00,$00,$00,$00,$00,$00,$00,$00	; $c3
	db $00,$00,$00,$00,$00,$00,$00,$00	; $c4
	db $00,$00,$00,$00,$00,$00,$00,$00	; $c5
	db $00,$00,$00,$00,$00,$00,$00,$00	; $c6
	db $00,$00,$00,$00,$00,$00,$00,$00	; $c7

	db $00,$00,$00,$00,$00,$00,$00,$00	; $c8
	db $00,$00,$00,$00,$00,$00,$00,$00	; $c9
	db $00,$00,$00,$00,$00,$00,$00,$00	; $ca
	db $00,$00,$00,$00,$00,$00,$00,$00	; $cb
	db $00,$00,$00,$00,$00,$00,$00,$00	; $cc
	db $00,$00,$00,$00,$00,$00,$00,$00	; $cd
	db $00,$00,$00,$00,$00,$00,$00,$00	; $ce
	db $00,$00,$00,$00,$00,$00,$00,$00	; $cf

	db $00,$00,$00,$00,$00,$00,$00,$00	; $d0
	db $00,$00,$00,$00,$00,$00,$00,$00	; $d1
	db $00,$00,$00,$00,$00,$00,$00,$00	; $d2
	db $00,$00,$00,$00,$00,$00,$00,$00	; $d3
	db $00,$00,$00,$00,$00,$00,$00,$00	; $d4
	db $00,$00,$00,$00,$00,$00,$00,$00	; $d5
	db $00,$00,$00,$00,$00,$00,$00,$00	; $d6
	db $00,$00,$00,$00,$00,$00,$00,$00	; $d7

	db $00,$00,$00,$00,$00,$00,$00,$00	; $d8
	db $00,$00,$00,$00,$00,$00,$00,$00	; $d9
	db $00,$00,$00,$00,$00,$00,$00,$00	; $da
	db $00,$00,$00,$00,$00,$00,$00,$00	; $db
	db $00,$00,$00,$00,$00,$00,$00,$00	; $dc
	db $00,$00,$00,$00,$00,$00,$00,$00	; $dd
	db $00,$00,$00,$00,$00,$00,$00,$00	; $de
	db $00,$00,$00,$00,$00,$00,$00,$00	; $df

	db $00,$00,$00,$00,$00,$00,$00,$00	; $e0
	db $00,$00,$00,$00,$00,$00,$00,$00	; $e1
	db $00,$00,$00,$00,$00,$00,$00,$00	; $e2
	db $00,$00,$00,$00,$00,$00,$00,$00	; $e3
	db $00,$00,$00,$00,$00,$00,$00,$00	; $e4
	db $00,$00,$00,$00,$00,$00,$00,$00	; $e5
	db $00,$00,$00,$00,$00,$00,$00,$00	; $e6
	db $00,$00,$00,$00,$00,$00,$00,$00	; $e7

	db $00,$00,$00,$00,$00,$00,$00,$00	; $e8
	db $00,$00,$00,$00,$00,$00,$00,$00	; $e9
	db $00,$00,$00,$00,$00,$00,$00,$00	; $ea
	db $00,$00,$00,$00,$00,$00,$00,$00	; $eb
	db $00,$00,$00,$00,$00,$00,$00,$00	; $ec
	db $00,$00,$00,$00,$00,$00,$00,$00	; $ed
	db $00,$00,$00,$00,$00,$00,$00,$00	; $ee
	db $00,$00,$00,$00,$00,$00,$00,$00	; $ef

	db $00,$00,$00,$00,$00,$00,$00,$00	; $f0
	db $00,$00,$00,$00,$00,$00,$00,$00	; $f1
	db $00,$00,$00,$00,$00,$00,$00,$00	; $f2
	db $00,$00,$00,$00,$00,$00,$00,$00	; $f3
	db $00,$00,$00,$00,$00,$00,$00,$00	; $f4
	db $00,$00,$00,$00,$00,$00,$00,$00	; $f5
	db $00,$00,$00,$00,$00,$00,$00,$00	; $f6
	db $00,$00,$00,$00,$00,$00,$00,$00	; $f7

	db $00,$00,$00,$00,$00,$00,$00,$00	; $f8
	db $00,$00,$00,$00,$00,$00,$00,$00	; $f9
	db $00,$00,$00,$00,$00,$00,$00,$00	; $fa
	db $00,$00,$00,$00,$00,$00,$00,$00	; $fb
	db $00,$00,$00,$00,$00,$00,$00,$00	; $fc
	db $00,$00,$00,$00,$00,$00,$00,$00	; $fd
	db $00,$00,$00,$00,$00,$00,$00,$00	; $fe
	db $00,$00,$00,$00,$00,$00,$00,$00	; $ff

	ds $8000-$,$ff

	;
	; Variables del juego
	;
	org $e000

	org $e400
stack:
